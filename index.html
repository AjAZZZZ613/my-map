<!DOCTYPE html>

<html lang="ru">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>TerraLens | Speed Edition</title>

    

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700;900&display=swap" rel="stylesheet">



    <style>

        :root { --neon: #00f2ff; --bg: rgba(0, 0, 0, 0.9); }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Montserrat', sans-serif; background: #000; overflow: hidden; }

        #map { width: 100%; height: 100vh; background: #0b1116; }



        /* –ò–ù–¢–†–û */

        #intro {

            position: fixed; top: 0; left: 0; width: 100%; height: 100%;

            display: flex; flex-direction: column; justify-content: center; align-items: center;

            background: radial-gradient(circle, #001a1a 0%, #000 100%);

            z-index: 9999; transition: 0.8s; text-align: center; color: white;

        }

        #intro.hidden { opacity: 0; visibility: hidden; transform: scale(1.1); }

        .btn-start {

            margin-top: 40px; padding: 18px 50px; border: 2px solid var(--neon); 

            background: transparent; color: var(--neon); cursor: pointer; font-size: 1rem; font-weight: 900;

            letter-spacing: 5px; text-transform: uppercase; transition: 0.3s;

        }

        .btn-start:hover { background: var(--neon); color: #000; box-shadow: 0 0 40px var(--neon); }



        /* –ü–û–ò–°–ö */

        .search-container {

            position: absolute; top: 30px; left: 50%; transform: translateX(-50%); 

            z-index: 1000; display: flex; gap: 10px;

        }

        #search-input {

            width: 250px; padding: 12px 25px; border-radius: 30px; border: 1px solid var(--neon);

            background: var(--bg); color: white; outline: none; backdrop-filter: blur(10px);

        }



        /* –ú–ï–ù–Æ */

        .ui-panel {

            position: absolute; top: 30px; left: 30px; z-index: 1000;

            background: var(--bg); padding: 15px; border-radius: 15px;

            border: 1px solid rgba(0, 242, 255, 0.2); width: 220px;

        }

        .nav-item {

            display: block; width: 100%; background: none; border: none; color: #fff;

            text-align: left; padding: 12px; cursor: pointer; opacity: 0.4; transition: 0.2s;

            border-left: 3px solid transparent; font-size: 0.8rem;

        }

        .nav-item.active { opacity: 1; color: var(--neon); border-left: 3px solid var(--neon); background: rgba(0, 242, 255, 0.1); }



        /* –ò–ù–§–û-–í–ò–î–ñ–ï–¢ (–£–°–ö–û–†–ï–ù–ù–´–ô) */

        #info-box {

            position: absolute; top: 30px; right: 30px; z-index: 1000;

            background: var(--bg); border: 1px solid var(--neon); padding: 20px;

            border-radius: 15px; color: white; width: 240px; display: none;

            box-shadow: 0 0 30px rgba(0, 242, 255, 0.2);

        }

        .flag-img { width: 100%; border-radius: 8px; margin-bottom: 10px; opacity: 0; transition: 0.5s; }

        .loading-text { font-size: 0.7rem; color: var(--neon); animation: blink 1s infinite; }

        @keyframes blink { 50% { opacity: 0.3; } }

        

        .temp-main { font-size: 3rem; font-weight: 900; }

        .label { font-size: 0.6rem; color: var(--neon); text-transform: uppercase; margin-top: 10px; }

        .val { font-size: 0.9rem; font-weight: 700; }



        .legend {

            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);

            z-index: 1000; background: white; padding: 8px 20px; border-radius: 50px;

            display: none; align-items: center; gap: 15px; font-weight: 900; font-size: 0.7rem; color: #000;

        }

        .gradient-bar { width: 120px; height: 8px; background: linear-gradient(to right, #ffffb2, #bd0026, #800026); border-radius: 5px; }

    </style>

</head>

<body>



    <div id="intro">

        <h1>TERRA<span style="color:var(--neon)">LENS</span></h1>

        <button class="btn-start" onclick="launch()">–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø</button>

    </div>



    <div id="map"></div>



    <div class="search-container">

        <input type="text" id="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥...">

        <button onclick="searchCity()" style="background:var(--neon); border:none; padding:10px 20px; border-radius:20px; cursor:pointer; font-weight:900;">üîç</button>

    </div>



    <div class="ui-panel">

        <button class="nav-item active" onclick="changeMode('pop', this)">üìä –ü–õ–û–¢–ù–û–°–¢–¨</button>

        <button class="nav-item" onclick="changeMode('sat', this)">üõ∞ –°–ü–£–¢–ù–ò–ö</button>

        <button class="nav-item" onclick="changeMode('rus', this)">üèô –ù–ê–í–ò–ì–ê–¢–û–†</button>

    </div>



    <div id="info-box">

        <div id="res-flag-container"></div>

        <div id="status" class="loading-text">–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï –û–ë–™–ï–ö–¢–ê...</div>

        

        <div class="label">–†–µ–≥–∏–æ–Ω</div>

        <div class="val" id="res-country">–û–∂–∏–¥–∞–Ω–∏–µ...</div>

        

        <div class="temp-main" id="res-temp">--¬∞C</div>

        

        <div style="display: flex; justify-content: space-between; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">

            <div>

                <div class="label">–í–µ—Ç–µ—Ä</div>

                <div class="val" id="res-wind">-- –∫–º/—á</div>

            </div>

            <div style="text-align: right;">

                <div class="label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</div>

                <div class="val" id="res-coords" style="font-size: 0.7rem;">--</div>

            </div>

        </div>

    </div>



    <div class="legend" id="pop-legend">

        <span>MIN</span><div class="gradient-bar"></div><span>MAX</span>

    </div>



    <script>

        let map, currentTile, geojsonLayer;



        const tileSets = {

            pop: 'https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png',

            sat: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',

            rus: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png'

        };



        function init() {

            map = L.map('map', { 

                zoomControl: false, 

                doubleClickZoom: false,

                attributionControl: false 

            }).setView([20, 0], 2);



            currentTile = L.tileLayer(tileSets.pop).addTo(map);



            map.on('click', (e) => fetchData(e.latlng.lat, e.latlng.lng));



            fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')

                .then(r => r.json()).then(data => {

                    geojsonLayer = L.geoJson(data, {

                        style: (f) => ({

                            fillColor: getCountryColor(f.properties.name),

                            weight: 1, color: 'white', fillOpacity: 0.6

                        })

                    }).addTo(map);

                });

            

            document.getElementById('pop-legend').style.display = 'flex';

        }



        function getCountryColor(name) {

            const colors = ['#ffffb2', '#fed976', '#feb24c', '#fd8d3c', '#f03b20', '#bd0026', '#800026'];

            let hash = 0;

            for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);

            return colors[Math.abs(hash) % colors.length];

        }



        async function fetchData(lat, lon) {

            const box = document.getElementById('info-box');

            box.style.display = 'block';

            

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª "–∑–∞–≥—Ä—É–∑–∫—É"

            document.getElementById('status').style.display = 'block';

            document.getElementById('res-country').innerText = "–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...";

            document.getElementById('res-temp').innerText = "--¬∞C";

            document.getElementById('res-flag-container').innerHTML = "";

            document.getElementById('res-coords').innerText = `${lat.toFixed(2)}, ${lon.toFixed(2)}`;



            // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û —á–µ—Ä–µ–∑ Promise.all

            try {

                const [geoRes, weatherRes] = await Promise.all([

                    fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json&accept-language=ru`),

                    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`)

                ]);



                const geoD = await geoRes.json();

                const wD = await weatherRes.json();



                // 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–≥–æ–¥—É (–æ–Ω–∞ –æ–±—ã—á–Ω–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –±—ã—Å—Ç—Ä–µ–µ)

                document.getElementById('res-temp').innerText = `${Math.round(wD.current_weather.temperature)}¬∞C`;

                document.getElementById('res-wind').innerText = `${wD.current_weather.windspeed} –∫–º/—á`;



                // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω—É –∏ —Ñ–ª–∞–≥

                const country = geoD.address.country || "–ú–∏—Ä–æ–≤–æ–π –æ–∫–µ–∞–Ω";

                const city = geoD.address.city || geoD.address.state || "–û—Ç–∫—Ä—ã—Ç–∞—è –∑–æ–Ω–∞";

                const code = geoD.address.country_code ? geoD.address.country_code.toLowerCase() : '';



                document.getElementById('res-country').innerText = `${country}, ${city}`;

                if(code) {

                    document.getElementById('res-flag-container').innerHTML = `<img src="https://flagcdn.com/w160/${code}.png" class="flag-img" style="opacity:1">`;

                }

                

                document.getElementById('status').style.display = 'none';



            } catch (e) {

                document.getElementById('res-country').innerText = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏";

                document.getElementById('status').innerText = "–ü–†–û–í–ï–†–¨–¢–ï –°–û–ï–î–ò–ù–ï–ù–ò–ï";

            }

        }



        function changeMode(type, btn) {

            map.removeLayer(currentTile);

            currentTile = L.tileLayer(tileSets[type]).addTo(map);



            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));

            btn.classList.add('active');



            if (type === 'pop') {

                geojsonLayer.addTo(map);

                document.getElementById('pop-legend').style.display = 'flex';

                map.flyTo([20, 0], 2);

            } else {

                if (map.hasLayer(geojsonLayer)) map.removeLayer(geojsonLayer);

                document.getElementById('pop-legend').style.display = 'none';

                if (type === 'rus') map.flyTo([55.75, 37.6], 10);

            }

        }



        async function searchCity() {

            const val = document.getElementById('search-input').value;

            if(!val) return;

            const r = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${val}`);

            const d = await r.json();

            if(d[0]) {

                const lat = parseFloat(d[0].lat);

                const lon = parseFloat(d[0].lon);

                map.flyTo([lat, lon], 10);

                fetchData(lat, lon);

            }

        }



        function launch() {

            document.getElementById('intro').classList.add('hidden');

        }



        window.onload = init;

    </script>

</body>

</html>

